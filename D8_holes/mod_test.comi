$PROJECTFOLDER FOLDER='/home/thiguchi/work/opera/210120_holes/' SET=YES 

CLEAR REVERT=NO
$string yesorno YES 


$OPEN 0 para_phi_0101b0.csv read
$CONSTANT #input openstream
$READ #input #par_MV #par_x0 #par_y0 #par_z0 #par_B0x #par_B0y #par_B0z
$CLOSE #input


//===== Definition of the variables =========
//--------- Definition of the variables by Takashi ------
VARIABLE OPTION=PARAMETER, NAME=#LE, VALUE=500, DESCRIPTION='length of the exterior volume'
VARIABLE OPTION=PARAMETER, NAME=#LES, VALUE=510, DESCRIPTION='length of the shell of the exterior'

VARIABLE OPTION=PARAMETER, NAME=#LI, VALUE=175, DESCRIPTION='length of inner volume' 
// Should change this if the number of layers is different? ask Aleksey
VARIABLE OPTION=PARAMETER, NAME=#L1, VALUE=120, DESCRIPTION='length of the first layer'
VARIABLE OPTION=PARAMETER, NAME=#t1, VALUE=0.1, DESCRIPTION='thickness of the first layer'
VARIABLE OPTION=PARAMETER, NAME=#L2, VALUE=130, DESCRIPTION='length of the second layer'
VARIABLE OPTION=PARAMETER, NAME=#t2, VALUE=0.15, DESCRIPTION='thickness of the second layer'
VARIABLE OPTION=PARAMETER, NAME=#L3, VALUE=150, DESCRIPTION='length of the third layer'
VARIABLE OPTION=PARAMETER, NAME=#t3, VALUE=0.15, DESCRIPTION='thickness of the third layer'
VARIABLE OPTION=PARAMETER, NAME=#L4, VALUE=175, DESCRIPTION='length of the forth layer'
VARIABLE OPTION=PARAMETER, NAME=#t4, VALUE=0.2, DESCRIPTION='thickness of the forth layer'

VARIABLE OPTION=PARAMETER, NAME=#LC, VALUE=450, DESCRIPTION='length of one edge of the coil'
VARIABLE OPTION=PARAMETER, NAME=#XC, VALUE=0, DESCRIPTION='X of the center of the coil'
VARIABLE OPTION=PARAMETER, NAME=#YC, VALUE=0, DESCRIPTION='Y of the center of the coil'
VARIABLE OPTION=PARAMETER, NAME=#ZC1, VALUE=-175, DESCRIPTION='Z of the center of the coil 1'
VARIABLE OPTION=PARAMETER, NAME=#ZC2, VALUE=175, DESCRIPTION='Z of the center of the coil 2'
VARIABLE OPTION=PARAMETER, NAME=#ZC3, VALUE=0, DESCRIPTION='Z of the center of the coil 3'
VARIABLE OPTION=PARAMETER, NAME=#IC1, VALUE=-1200, DESCRIPTION='current of the coil 1'
VARIABLE OPTION=PARAMETER, NAME=#IC2, VALUE=-1200, DESCRIPTION='current of the coil 2'
VARIABLE OPTION=PARAMETER, NAME=#IC3, VALUE=0, DESCRIPTION='current of the coil 3'

VARIABLE OPTION=PARAMETER, NAME=#MS, VALUE=5, DESCRIPTION='Mesh size used on the MSR layers'


VARIABLE OPTION=PARAMETER, NAME=#HoleR, VALUE=5, DESCRIPTION='radius of the feedthrough hole'
/diameter of the center hole
VARIABLE OPTION=PARAMETER, NAME=#HoleRc, VALUE=7.5, DESCRIPTION='radius of the feedthrough hole' 

VARIABLE OPTION=PARAMETER, NAME=#HoleRlr1, VALUE=5, DESCRIPTION='radius of the feedthrough hole on left right planes' 
VARIABLE OPTION=PARAMETER, NAME=#HoleRlr2, VALUE=4, DESCRIPTION='radius of the feedthrough hole on left right planes' 

VARIABLE OPTION=PARAMETER, NAME=#dlr1, VALUE=21, DESCRIPTION='distance between the feedthrough hole on left right planes' 
VARIABLE OPTION=PARAMETER, NAME=#dlr2, VALUE=15, DESCRIPTION='distance between the feedthrough hole on left right planes' 

VARIABLE OPTION=PARAMETER, NAME=#Plr1, VALUE=210, DESCRIPTION='position of the feedthrough hole on left right planes' 
VARIABLE OPTION=PARAMETER, NAME=#Plr2, VALUE=15.75, DESCRIPTION='position of the feedthrough hole on left right planes' 


VARIABLE OPTION=PARAMETER, NAME=#L1_thickness, VALUE=#t1, DESCRIPTION='thickness of the Layer 1'
VARIABLE OPTION=PARAMETER, NAME=#L2_thickness, VALUE=#t2, DESCRIPTION='thickness of the Layer 2'
VARIABLE OPTION=PARAMETER, NAME=#L3_thickness, VALUE=#t3 DESCRIPTION='thickness of the Layer 3'
VARIABLE OPTION=PARAMETER, NAME=#L4_thickness, VALUE=#t4, DESCRIPTION='thickness of the Layer 4'

VARIABLE OPTION=PARAMETER, NAME=#L1_size, VALUE=#L1, DESCRIPTION='half size of the Layer 1'
VARIABLE OPTION=PARAMETER, NAME=#L2_size, VALUE=#L2, DESCRIPTION='half size of the Layer 2'
VARIABLE OPTION=PARAMETER, NAME=#L3_size, VALUE=#L3, DESCRIPTION='half size of the Layer 3'
VARIABLE OPTION=PARAMETER, NAME=#L4_size, VALUE=#L4, DESCRIPTION='half size of the Layer 4'


//===== (end of the definition of the variables) =========

//====== Definition of the MSR model bodies =======
// ----------Internal and external volume and the shell ----------------------
BLOCK Name='InnerBlock' X0=-#LI Y0=-#LI Z0=-#LI X1=#LI Y1=#LI Z1=#LI MATERIALLABEL='Air' LEVEL=1
PICK OPTION=ADD PROPERTY=UniqueName LABEL=InnerBlock
CELLDATA OPTION=MODIFY POTENTIAL=total ELEMENTTYPE=Linear size=#MS ELEMSHAPEPREF=NONE

BLOCK Name='ReducedVol' X0=-#LE Y0=-#LE Z0=-#LE X1=#LE Y1=#LE Z1=#LE MATERIALLABEL='Air' LEVEL=1
PICK OPTION=ADD PROPERTY=UniqueName LABEL=ReducedVol
/CELLDATA OPTION=MODIFY POTENTIAL=reduced ELEMENTTYPE=Linear size=20 ELEMSHAPEPREF=NONE
CELLDATA OPTION=MODIFY POTENTIAL=reduced ELEMENTTYPE=Linear size=10 ELEMSHAPEPREF=NONE
/CELLDATA OPTION=MODIFY POTENTIAL=total ELEMENTTYPE=Linear size=20 ELEMSHAPEPREF=NONE

BLOCK Name='ShellOut' X0=-#LES Y0=-#LES Z0=-#LES X1=#LES Y1=#LES Z1=#LES MATERIALLABEL='Air' LEVEL=2
BLOCK Name='ShellIn' X0=-#LE Y0=-#LE Z0=-#LE X1=#LE Y1=#LE Z1=#LE MATERIALLABEL='Air' LEVEL=2
PICK OPTION=ADD, | PICK PROPERTY=Name LABEL=ShellOut 
PICK OPTION=ADD, | PICK PROPERTY=Name LABEL=ShellIn
COMBINE OPERATION=SUBTRACT +REGULAR
PICK OPTION=ADD PROPERTY=UniqueName LABEL=ShellOut
/CELLDATA OPTION=MODIFY POTENTIAL=total ELEMENTTYPE=Linear SIZE=5 ELEMSHAPEPREF=NONE
/CELLDATA OPTION=MODIFY POTENTIAL=reduced ELEMENTTYPE=Linear SIZE=20 ELEMSHAPEPREF=NONE
CELLDATA OPTION=MODIFY POTENTIAL=total ELEMENTTYPE=Linear SIZE=20 ELEMSHAPEPREF=NONE

PICK OPTION=TOGGLE TYPE=FACE UNIQUEBODYNAME='ShellOut' IDENTIFIER=A.00001
PICK OPTION=TOGGLE TYPE=FACE UNIQUEBODYNAME='ShellOut' IDENTIFIER=A.00002
PICK OPTION=TOGGLE TYPE=FACE UNIQUEBODYNAME='ShellOut' IDENTIFIER=A.00003
PICK OPTION=TOGGLE TYPE=FACE UNIQUEBODYNAME='ShellOut' IDENTIFIER=A.00004
PICK OPTION=TOGGLE TYPE=FACE UNIQUEBODYNAME='ShellOut' IDENTIFIER=A.00005
PICK OPTION=TOGGLE TYPE=FACE UNIQUEBODYNAME='ShellOut' IDENTIFIER=A.00006
FACEDATA OPTION=MODIFY BOUNDARYLABEL='sides' ELEMENTTYPE=Linear FORMETHOD=NONE BACKMETHOD=NONE
//--------- (end of the definition of the inner and exterior voulmes)-----

//------ Layer L4
VARIABLE OPTION=PARAMETER, NAME=#D2 VALUE=#L4_size+#L4_thickness
VARIABLE OPTION=PARAMETER, NAME=#D1 VALUE=#L4_size

/VARIABLE OPTION=PARAMETER, NAME=#SHIFTM VALUE=-37.5
/VARIABLE OPTION=PARAMETER, NAME=#SHIFTP VALUE=37.5


VARIABLE OPTION=PARAMETER, NAME=#SHIFTM VALUE=-37.5+#HoleR
VARIABLE OPTION=PARAMETER, NAME=#SHIFTP VALUE=37.5-#HoleR
VARIABLE OPTION=PARAMETER, NAME=#SHIFTPV VALUE=75-#HoleR   
VARIABLE OPTION=PARAMETER, NAME=#SHIFTMV VALUE=-75+#HoleR



BLOCK Name='L4_Out' X0=-#D2 Y0=-#D2 Z0=-#D2 X1=#D2 Y1=#D2 Z1=#D2 MATERIALLABEL='mumetal'  LEVEL=2
BLOCK Name='L4_In' X0=-#D1 Y0=-#D1 Z0=-#D1 X1=#D1 Y1=#D1 Z1=#D1 LEVEL=2
PICK OPTION=ADD, | PICK PROPERTY=Name LABEL=L4_Out 
PICK OPTION=ADD, | PICK PROPERTY=Name LABEL=L4_In 
CELLDATA OPTION=MODIFY POTENTIAL=total ELEMENTTYPE=Linear size=#MS ELEMSHAPEPREF=NONE
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L4_Out 
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L4_In 
COMBINE OPERATION=SUBTRACT +REGULAR


/VARIABLE OPTION=PARAMETER, NAME=#IND VALUE=0
/VARIABLE OPTION=PARAMETER, NAME=#D1 VALUE=-#D1
/VARIABLE OPTION=PARAMETER, NAME=#D2 VALUE=-#D2

VARIABLE OPTION=PARAMETER, NAME=#SGN0 VALUE=+1
VARIABLE OPTION=PARAMETER, NAME=#SGN1 VALUE=+1

$DO #IND 0 1 1
$IF #IND EQ 1
 VARIABLE OPTION=PARAMETER, NAME=#D1 VALUE=-#L4_size-#L4_thickness
 VARIABLE OPTION=PARAMETER, NAME=#D2 VALUE=-#L4_size
$END IF

$DO #IND0 0 1 1
$IF #IND0 EQ 1
 VARIABLE OPTION=PARAMETER, NAME=#SGN0 VALUE=-1
$END IF
$DO #IND1 0 1 1
$IF #IND1 EQ 1
 VARIABLE OPTION=PARAMETER, NAME=#SGN1 VALUE=-1
$END IF
/CYLINDER Name='Cylinder4' X0=0 Y0=#D1 Z0=0 X1=0 Y1=#D2 Z1=0 -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=#HoleRc MINORRADIUS=#HoleRc TOPRADIUS=#HoleRc SIDES=2
/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L4_Out 
/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=Cylinder4
/COMBINE OPERATION=SUBTRACT +REGULAR

/CYLINDER Name='Cylinder4' X0=#SHIFTP Y0=#D1 Z0=#SHIFTMV X1=#SHIFTP Y1=#D2 Z1=#SHIFTMV -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=#HoleR MINORRADIUS=#HoleR TOPRADIUS=#HoleR SIDES=2
/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L4_Out 
/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=Cylinder4
/COMBINE OPERATION=SUBTRACT +REGULAR

/CYLINDER Name='Cylinder4' X0=#SHIFTM Y0=#D1 Z0=#SHIFTPV X1=#SHIFTM Y1=#D2 Z1=#SHIFTPV -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=#HoleR MINORRADIUS=#HoleR TOPRADIUS=#HoleR SIDES=2
/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L4_Out 
/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=Cylinder4
/COMBINE OPERATION=SUBTRACT +REGULAR


CYLINDER Name='Cylinder4' X0=#D1 Y0=#Plr1*#SGN0 Z0=#Plr1*#SGN1 X1=#D2 Y1=#Plr1*#SGN0 Z1=#Plr1*#SGN1 -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=#HoleRlr1 MINORRADIUS=#HoleRlr1 TOPRADIUS=#HoleRlr1 SIDES=2
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L4_Out
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=Cylinder4
COMBINE OPERATION=SUBTRACT +REGULAR

CYLINDER Name='Cylinder4' X0=#D1 Y0=#Plr1*#SGN0 Z0=(#Plr1-#dlr1)*#SGN1 X1=#D2 Y1=#Plr1*#SGN0 Z1=(#Plr1-#dlr1)*#SGN1 -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=#HoleRlr1 MINORRADIUS=#HoleRlr1 TOPRADIUS=#HoleRlr1 SIDES=2
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L4_Out
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=Cylinder4
COMBINE OPERATION=SUBTRACT +REGULAR

$END DO
$END DO
$END DO


/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L4_Out 
/CELLDATA OPTION=MODIFY MATERIALLABEL='mumetal' POTENTIAL=Default ELEMENTTYPE=Linear ELEMSHAPEPREF=NONE


//---- Layer L3
VARIABLE OPTION=PARAMETER, NAME=#D2 VALUE=#L3_size+#L3_thickness
VARIABLE OPTION=PARAMETER, NAME=#D1 VALUE=#L3_size

BLOCK Name='L3_Out' X0=-#D2 Y0=-#D2 Z0=-#D2 X1=#D2 Y1=#D2 Z1=#D2 MATERIALLABEL='mumetal' LEVEL=2
BLOCK Name='L3_In' X0=-#D1 Y0=-#D1 Z0=-#D1 X1=#D1 Y1=#D1 Z1=#D1 LEVEL=2
PICK OPTION=ADD, | PICK PROPERTY=Name LABEL=L3_Out 
PICK OPTION=ADD, | PICK PROPERTY=Name LABEL=L3_In
CELLDATA OPTION=MODIFY POTENTIAL=total ELEMENTTYPE=Linear size=#MS ELEMSHAPEPREF=NONE
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L3_Out 
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L3_In
COMBINE OPERATION=SUBTRACT +REGULAR

VARIABLE OPTION=PARAMETER, NAME=#SGN0 VALUE=+1
VARIABLE OPTION=PARAMETER, NAME=#SGN1 VALUE=+1

//----- Do loop------
$DO #IND 0 1 1
$IF #IND EQ 1
 VARIABLE OPTION=PARAMETER, NAME=#D1 VALUE=-#L3_size-#L3_thickness
 VARIABLE OPTION=PARAMETER, NAME=#D2 VALUE=-#L3_size
$END IF

$DO #IND0 0 1 1
$IF #IND0 EQ 1
 VARIABLE OPTION=PARAMETER, NAME=#SGN0 VALUE=-1
$END IF
$DO #IND1 0 1 1
$IF #IND1 EQ 1
 VARIABLE OPTION=PARAMETER, NAME=#SGN1 VALUE=-1
$END IF

/CYLINDER Name='Cylinder3' X0=0 Y0=#D1 Z0=0 X1=0 Y1=#D2 Z1=0 -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=#HoleRc MINORRADIUS=#HoleRc TOPRADIUS=#HoleRc SIDES=2
/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L3_Out 
/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=Cylinder3
/COMBINE OPERATION=SUBTRACT +REGULAR

/CYLINDER Name='Cylinder3' X0=#SHIFTP Y0=#D1 Z0=#SHIFTMV X1=#SHIFTP Y1=#D2 Z1=#SHIFTMV -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=#HoleR MINORRADIUS=#HoleR TOPRADIUS=#HoleR SIDES=2
/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L3_Out 
/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=Cylinder3
/COMBINE OPERATION=SUBTRACT +REGULAR

/CYLINDER Name='Cylinder3' X0=#SHIFTM Y0=#D1 Z0=#SHIFTPV X1=#SHIFTM Y1=#D2 Z1=#SHIFTPV -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=#HoleR MINORRADIUS=#HoleR TOPRADIUS=#HoleR SIDES=2
/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L3_Out 
/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=Cylinder3
/COMBINE OPERATION=SUBTRACT +REGULAR

CYLINDER Name='Cylinder3' X0=#D1 Y0=#Plr1*#SGN0 Z0=#Plr1*#SGN1 X1=#D2 Y1=#Plr1*#SGN0 Z1=#Plr1*#SGN1 -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=#HoleRlr1 MINORRADIUS=#HoleRlr1 TOPRADIUS=#HoleRlr1 SIDES=2
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L3_Out
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=Cylinder3
COMBINE OPERATION=SUBTRACT +REGULAR

CYLINDER Name='Cylinder3' X0=#D1 Y0=#Plr1*#SGN0 Z0=(#Plr1-#dlr1)*#SGN1 X1=#D2 Y1=#Plr1*#SGN0 Z1=(#Plr1-#dlr1)*#SGN1 -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=#HoleRlr1 MINORRADIUS=#HoleRlr1 TOPRADIUS=#HoleRlr1 SIDES=2
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L3_Out
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=Cylinder3
COMBINE OPERATION=SUBTRACT +REGULAR
$END DO
$END DO
$END DO

//----- Layer L2 -------
VARIABLE OPTION=PARAMETER, NAME=#D2 VALUE=#L2_size+#L2_thickness
VARIABLE OPTION=PARAMETER, NAME=#D1 VALUE=#L2_size

BLOCK Name='L2_Out' X0=-#D2 Y0=-#D2 Z0=-#D2 X1=#D2 Y1=#D2 Z1=#D2 MATERIALLABEL='mumetal' LEVEL=2
BLOCK Name='L2_In' X0=-#D1 Y0=-#D1 Z0=-#D1 X1=#D1 Y1=#D1 Z1=#D1 LEVEL=2
PICK OPTION=ADD, | PICK PROPERTY=Name LABEL=L2_Out 
PICK OPTION=ADD, | PICK PROPERTY=Name LABEL=L2_In 
CELLDATA OPTION=MODIFY POTENTIAL=total ELEMENTTYPE=Linear size=#MS ELEMSHAPEPREF=NONE
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L2_Out 
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L2_In 
COMBINE OPERATION=SUBTRACT +REGULAR

VARIABLE OPTION=PARAMETER, NAME=#SGN0 VALUE=+1
VARIABLE OPTION=PARAMETER, NAME=#SGN1 VALUE=+1
//----- Do loop------
$DO #IND 0 1 1
$IF #IND EQ 1
 VARIABLE OPTION=PARAMETER, NAME=#D1 VALUE=-#L2_size-#L2_thickness
 VARIABLE OPTION=PARAMETER, NAME=#D2 VALUE=-#L2_size
$END IF

$DO #IND0 0 1 1
$IF #IND0 EQ 1
 VARIABLE OPTION=PARAMETER, NAME=#SGN0 VALUE=-1
$END IF
$DO #IND1 0 1 1
$IF #IND1 EQ 1
 VARIABLE OPTION=PARAMETER, NAME=#SGN1 VALUE=-1
$END IF

/CYLINDER Name='Cylinder2' X0=0 Y0=#D1 Z0=0 X1=0 Y1=#D2 Z1=0 -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=#HoleRc MINORRADIUS=#HoleRc TOPRADIUS=#HoleRc SIDES=2
/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L2_Out 
/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=Cylinder2
/COMBINE OPERATION=SUBTRACT +REGULAR

/CYLINDER Name='Cylinder2' X0=#SHIFTP Y0=#D1 Z0=#SHIFTMV X1=#SHIFTP Y1=#D2 Z1=#SHIFTMV -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=#HoleR MINORRADIUS=#HoleR TOPRADIUS=#HoleR SIDES=2
/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L2_Out 
/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=Cylinder2
/COMBINE OPERATION=SUBTRACT +REGULAR

/CYLINDER Name='Cylinder2' X0=#SHIFTM Y0=#D1 Z0=#SHIFTPV X1=#SHIFTM Y1=#D2 Z1=#SHIFTPV -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=#HoleR MINORRADIUS=#HoleR TOPRADIUS=#HoleR SIDES=2
/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L2_Out 
/PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=Cylinder2
/COMBINE OPERATION=SUBTRACT +REGULAR

CYLINDER Name='Cylinder2' X0=#D1 Y0=#Plr1*#SGN0 Z0=#Plr1*#SGN1 X1=#D2 Y1=#Plr1*#SGN0 Z1=#Plr1*#SGN1 -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=#HoleRlr1 MINORRADIUS=#HoleRlr1 TOPRADIUS=#HoleRlr1 SIDES=2
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L2_Out
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=Cylinder2
COMBINE OPERATION=SUBTRACT +REGULAR

CYLINDER Name='Cylinder2' X0=#D1 Y0=#Plr1*#SGN0 Z0=(#Plr1-#dlr1)*#SGN1 X1=#D2 Y1=#Plr1*#SGN0 Z1=(#Plr1-#dlr1)*#SGN1 -TUBE SHAPECONTROL=SIMPLE MAJORRADIUS=#HoleRlr1 MINORRADIUS=#HoleRlr1 TOPRADIUS=#HoleRlr1 SIDES=2
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L2_Out
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=Cylinder2
COMBINE OPERATION=SUBTRACT +REGULAR

$END DO
$END DO
$END DO


//------- Layer L1 -----
VARIABLE OPTION=PARAMETER, NAME=#D2 VALUE=#L1_size+#L1_thickness
VARIABLE OPTION=PARAMETER, NAME=#D1 VALUE=#L1_size

BLOCK Name='L1_Out' X0=-#D2 Y0=-#D2 Z0=-#D2 X1=#D2 Y1=#D2 Z1=#D2 MATERIALLABEL='mumetal' LEVEL=2
BLOCK Name='L1_In' X0=-#D1 Y0=-#D1 Z0=-#D1 X1=#D1 Y1=#D1 Z1=#D1 LEVEL=2

PICK OPTION=ADD, | PICK PROPERTY=Name LABEL=L1_Out 
PICK OPTION=ADD, | PICK PROPERTY=Name LABEL=L1_In 
CELLDATA OPTION=MODIFY POTENTIAL=total ELEMENTTYPE=Linear size=#MS ELEMSHAPEPREF=NONE
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L1_Out 
PICK OPTION=TOGGLE, | PICK PROPERTY=Name LABEL=L1_In 
COMBINE OPERATION=SUBTRACT +REGULAR

VARIABLE OPTION=PARAMETER, NAME=#SGN0 VALUE=+1
VARIABLE OPTION=PARAMETER, NAME=#SGN1 VALUE=+1
//------- Do loop ------
$DO #IND 0 1 1
$IF #IND EQ 1
 VARIABLE OPTION=PARAMETER, NAME=#D1 VALUE=-#L1_size-#L1_thickness
 VARIABLE OPTION=PARAMETER, NAME=#D2 VALUE=-#L1_size
$END IF

$DO #IND0 0 1 1
$IF #IND0 EQ 1
 VARIABLE OPTION=PARAMETER, NAME=#SGN0 VALUE=-1
$END IF
$DO #IND1 0 1 1
$IF #IND1 EQ 1
 VARIABLE OPTION=PARAMETER, NAME=#SGN1 VALUE=-1
$END IF
